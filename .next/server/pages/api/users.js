"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,n)=>{Object.defineProperty(n,"l",{enumerable:!0,get:function(){return function e(n,o){return o in n?n[o]:"then"in n&&"function"==typeof n.then?n.then(n=>e(n,o)):"function"==typeof n&&"default"===o?n:void 0}}})},8843:(e,n,o)=>{o.r(n),o.d(n,{config:()=>y,default:()=>u,routeModule:()=>f});var t={};o.r(t),o.d(t,{default:()=>c});var i=o(1802),r=o(7153),a=o(6249);let{default:l}=o(1185),s=new l.Schema({name:{type:String,required:!0},lastName:{type:String,required:!0},password:{type:String,required:!0},contacts:{type:{phone:{type:String,required:!0},telegram:{type:String},mail:{type:String}},required:!0},birthDay:{type:String},isAutorise:{type:Boolean,required:!0}}),{default:d}=o(1185);async function c(e,n){try{await d.connect("mongodb+srv://Andrii:Monoliz_1503@yulina-is-a-meaty-delig.5lgdn.mongodb.net/users?retryWrites=true&w=majority&appName=yulina-is-a-meaty-delight"),console.log("Connected to DB");let t=d.models.user||d.model("user",s);if("POST"===e.method){if("create"===e.query.work){let{name:o,lastName:i,password:r,contacts:a}=e.body,l=await t.findOne({"contacts.phone":a.phone});l?(console.log("User found:",l),n.send("Користувач з таким телефоном вже існує")):new t({name:o,lastName:i,password:r,contacts:a,isAutorise:!1}).save().then(e=>n.send("Успішно зареєстровано!")).catch(e=>{console.log(e)}).finally(()=>{d.connection.close(),console.log("Close DB")})}else if("change"===e.query.work){let{id:n,updateData:i}=e.body;async function o(){try{console.log(i);let e=await t.findByIdAndUpdate(n,i,{new:!0});console.log("Оновлений документ:",e)}catch(e){console.error("Помилка при оновленні:",e)}finally{await d.connection.close(),console.log("Close DB")}}o()}else if("get-user"===e.query.work){let{userID:o}=e.body;if(o){let e=await t.findOne({_id:o});n.send(e)}}else if("authorise"===e.query.work){let{phone:i,password:r}=e.body,a=await t.findOne({"contacts.phone":i});if(a.password=r){async function o(){try{await t.findByIdAndUpdate(a._id,{isAutorise:!0},{new:!0}),n.send({message:"Користувача авторизовано",id:a._id})}catch(e){n.send("Помилка при авторизації:",e)}finally{await d.connection.close(),console.log("Close DB")}}o()}}else if("delete"===e.query.work){let{id:n}=e.body;(async function(){try{let e=await t.findByIdAndDelete(n);e?console.log("Документ видалено:",e):console.log("Документ не знайдено")}catch(e){console.error("Помилка при видаленні:",e)}finally{await d.connection.close(),console.log("Close DB")}})()}}}catch(e){console.error("Error connecting to DB:",e)}}let u=(0,a.l)(t,"default"),y=(0,a.l)(t,"config"),f=new i.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/users",pathname:"/api/users",bundlePath:"",filename:""},userland:t})},7153:(e,n)=>{var o;Object.defineProperty(n,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,n,o)=>{e.exports=o(145)}};var n=require("../../webpack-api-runtime.js");n.C(e);var o=n(n.s=8843);module.exports=o})();